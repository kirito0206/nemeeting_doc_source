# 外部IM集成会议模块

本文档详细介绍如何集成外部IM能力与网易会议SDK，实现用户状态或会议事件在两个系统间的无缝同步。

## 核心集成要点

### 1. 初始化与登录同步

为确保网易会议与外部IM系统的一致性，必须将两者的初始化和登录操作保持同步。具体实现方法如下：

- 在应用启动时，同时初始化网易会议SDK和外部IM SDK
- 用户登录时，确保两个系统的登录时机和状态保持一致
- 用户登出时，同步登出两个系统

### 2. 用户状态同步

为了在IM系统和会议系统之间实现用户状态的实时同步：

- 当用户在线状态发生变化时，同步更新两个系统的状态
- 监听会议加入/退出事件，在IM系统中标记用户为"会议中"状态
- 当用户结束会议后，恢复原始IM状态

## 具体实现步骤

### 步骤一：SDK初始化同步

   **示例代码如下：**

    ```Objective-C
    // 同时初始化网易会议SDK和外部IM SDK
    [[NE MeetingManager sharedManager] initializeWithAppKey:appKey secret:secret completion:^(NSInteger code, NSString * _Nullable msg) {
        if (code == 0) {
            // 网易会议SDK初始化成功
            // 初始化外部IM SDK
            [ExternalIMSDK initializeWithAppKey:appKey token:token];
        } else {
            // 网易会议SDK初始化失败
        }
    }];
    ```

### 步骤二：用户状态同步

   **示例代码如下：**

    ```Objective-C
    // 监听会议状态变化
    [[NE MeetingManager sharedManager] observeMeetingStatus:^(NEEnumMeetingStatus status) {
        // 根据会议状态更新IM状态
        [ExternalIMSDK updateUserStatus];
    }];
    ```



## 最佳实践

1. **错误处理**：在同步过程中，确保对每个操作都有适当的错误处理和重试机制
2. **性能优化**：避免频繁的状态更新，可采用防抖机制减少不必要的API调用
3. **数据一致性**：在用户离线或网络异常情况下，确保数据能够正确同步
4. **安全性**：确保用户隐私数据在两个系统间的安全传输

## 常见问题解答

**Q: 如何将网易会议初始化和登录与外部IM系统保持一致？**

A: 网易会议初始化和登录应保持跟外部IM初始化登录调用时机保持一致，确保两个系统的用户状态同步。

**Q: 如何集成外部IM能力与网易会议SDK，实现用户状态或会议事件及时同步？**

A: 外部监听会议状态变更事件，进行IM业务通知等。如果要利用外部IM来实现会议邀请，可以参考 会议管理/邀请入会.md 文档。

**Q: 如何处理网络异常情况下的状态同步？**

A: 建议实现本地缓存机制，在网络恢复后重新同步未完成的操作，并提供适当的状态回退策略。

**Q: 是否支持自定义会议事件类型？**

A: 是的，可以通过自定义会议事件监听器来扩展会议事件类型，并根据业务需求推送至IM系统。